# 1.4 스트림

거의 모든 자바 애플리케이션은 컬렉션을 만들고 활용하지만 컬렉션으로 모든 문제가 해결되진 않는다.
스트림 API는 상당히 다른 방식으로 데이터를 처리해 문제를 해결할 수 있는 방법을 제공한다.

```java
Map<Currency, List<Transaction>> transactionByCurrencies = 
transactions.stream()
  .filter((Transaction t) -> t.getPrice() > 1000) // 고가의 트랙잭션 필터링
  .collect(groupingBy(Transaction::getCurrency)); // 통화로 그룹화
```

- for-each 루프를 사용하면 각 요소를 직접 반복하는 외부 반복 수행
- 스트림 API는 내부에서 모든 데이터가 처리되는 내부 반복 수행

> 컬렉션을 활용하면 거대한 리스트의 경우 오랜 시간이 걸릴 수 있다.  
> 멀티코어 컴퓨터를 활용해 CPU 코어에 작업을 각각 할당해 처리 시간을 줄일 수 있다면 좋을 것이다!

#### 💡 멀티코어 컴퓨터
- 최신 데스크톱과 랩톱 컴퓨터는 모두 멀티코어를 장착 (단일 CPU가 아닌 4, 8개 이상의 CPU)
- 전통적인 자바 프로그램은 이렇게 많은 CPU 중 단 하나만 사용해 CPU를 낭비시킨다는 문제 존재
- 자바 8에서는 이런 컴퓨터를 더 잘 활용할 수 있는 새로운 프로그래밍 스타일 제공

#
### 멀티스레딩은 어렵다
이전 자바 버전에서 제공하는 스레드 API로 멀티스레딩 코드를 구현해 병렬성을 이용하는 것은 쉽지 않다.
- 멀티스레딩 환경에서 각각의 스레드는 동시에 공유된 데이터에 접근하고 데이터 갱신 가능
- 스레듣를 제대로 제어하지 못하면 원치 않는 방식으로 데이터가 바뀌어 순차적인 모델보다 다루기가 어려움

#### 🎯 자바 8은 스트림 API 로 `컬렉션을 처리하면서 발생하는 모호함과 반복적인 코드 문제`, `멀티코어 활용 어려움` 이라는 두가지 문제를 모두 해결!!

#### 스트림 API의 기능 예시
- 자주 반복되는 패턴으로 주어진 조건에 따라 데이터를 필터링 (10000원 이하 물건 선택)
- 데이터 추출 (물건의 가격 필드 추출)
- 데이터 그룹화 (숫자를 짝수와 홀수로 그룹화)

#### 스트림 API와 병렬화
- 위와 같은 기능들을 쉽게 병렬화 가능
- 리스트의 앞부분과 뒷부분을 두 CPU가 나눠서 처리 가능

1) 포킹 단계: 리스트를 여러개의 CPU로 포킹
2) 각각의 CPU가 자신이 맡은 작업 처리
3) 하나의 CPU가 두 결과를 정리

> 컬렉션은 어떻게 데이터를 저장하고 접근할지에 중점을 두고, 스트림은 데이터에 어던 계산을 하고 묘사할 것인지에 중점을 둔다!!

#### 스트림은 스트림 내의 요소를 쉽게 병렬로 처리할 수 있는 환경을 제공!

> 순차 처리 방식의 코드
```java
List<Apple> heavyApples = 
  inventory.stream().filter((Apple a) -> a.getWeight() > 150)
  .collect(toList());
```

> 병렬 처리 방식의 코드
```java
List<Apple> heavyApples = 
  inventory.parallelStream().filter((Apple a) -> a.getWeight() > 150)
  .collect(toList());
```
